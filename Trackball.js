"use strict";THREE.TrackballControls=function(a,b){function c(a){!1!==m.enabled&&(window.removeEventListener("keydown",c),q!==n.NONE||(a.keyCode!==m.keys[n.ROTATE]||m.noRotate?a.keyCode!==m.keys[n.ZOOM]||m.noZoom?a.keyCode!==m.keys[n.PAN]||m.noPan||(q=n.PAN):q=n.ZOOM:q=n.ROTATE))}function d(){!1===m.enabled||(q=n.NONE,window.addEventListener("keydown",c,!1))}function e(a){if(!1!==m.enabled){if(a.preventDefault(),a.stopPropagation(),p===n.NONE)switch(a.button){case m.mouseButtons.LEFT:p=n.ROTATE;break;case m.mouseButtons.MIDDLE:p=n.ZOOM;break;case m.mouseButtons.RIGHT:p=n.PAN;break;default:p=n.NONE;}var b=q===n.NONE?p:q;b!==n.ROTATE||m.noRotate?b!==n.ZOOM||m.noZoom?b===n.PAN&&!m.noPan&&(B.copy(G(a.pageX,a.pageY)),C.copy(B)):(w.copy(G(a.pageX,a.pageY)),x.copy(w)):(t.copy(H(a.pageX,a.pageY)),s.copy(t)),document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",g,!1),m.dispatchEvent(E)}}function f(a){if(!1!==m.enabled){a.preventDefault(),a.stopPropagation();var b=q===n.NONE?p:q;b!==n.ROTATE||m.noRotate?b!==n.ZOOM||m.noZoom?b===n.PAN&&!m.noPan&&C.copy(G(a.pageX,a.pageY)):x.copy(G(a.pageX,a.pageY)):(s.copy(t),t.copy(H(a.pageX,a.pageY)))}}function g(a){!1===m.enabled||(a.preventDefault(),a.stopPropagation(),p=n.NONE,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g),m.dispatchEvent(F))}function h(a){if(!1!==m.enabled&&!0!==m.noZoom){switch(a.preventDefault(),a.stopPropagation(),a.deltaMode){case 2:w.y-=.025*a.deltaY;break;case 1:w.y-=.01*a.deltaY;break;default:w.y-=25e-5*a.deltaY;}m.dispatchEvent(E),m.dispatchEvent(F)}}function i(a){switch(a.touches.length){case 1:p=n.TOUCH_ROTATE,t.copy(H(a.touches[0].pageX,a.touches[0].pageY)),s.copy(t);break;default:p=n.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;A=z=Math.sqrt(b*b+c*c);var d=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;B.copy(G(d,e)),C.copy(B);}!1===m.enabled||m.dispatchEvent(E)}function j(a){if(!1!==m.enabled)switch(a.touches.length){case 1:s.copy(t),t.copy(H(a.touches[0].pageX,a.touches[0].pageY));break;default:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;A=Math.sqrt(b*b+c*c);var d=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;C.copy(G(d,e));}}function k(a){switch(a.touches.length){case 0:p=n.NONE;break;case 1:p=n.TOUCH_ROTATE,t.copy(H(a.touches[0].pageX,a.touches[0].pageY)),s.copy(t);}!1===m.enabled||m.dispatchEvent(F)}function l(a){!1===m.enabled||a.preventDefault()}var m=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=a,this.domElement=b===void 0?document:b,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.ZOOM,RIGHT:THREE.MOUSE.PAN},this.target=new THREE.Vector3;var o=new THREE.Vector3,p=n.NONE,q=n.NONE,r=new THREE.Vector3,s=new THREE.Vector2,t=new THREE.Vector2,u=new THREE.Vector3,v=0,w=new THREE.Vector2,x=new THREE.Vector2,z=0,A=0,B=new THREE.Vector2,C=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var D={type:"change"},E={type:"start"},F={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft,this.screen.top=a.top+window.pageYOffset-b.clientTop,this.screen.width=a.width,this.screen.height=a.height}};var G=function(){var a=new THREE.Vector2;return function(b,c){return a.set((b-m.screen.left)/m.screen.width,(c-m.screen.top)/m.screen.height),a}}(),H=function(){var a=new THREE.Vector2;return function(b,c){return a.set((b-.5*m.screen.width-m.screen.left)/(.5*m.screen.width),(m.screen.height+2*(m.screen.top-c))/m.screen.width),a}}();this.rotateCamera=function(){var a,b=new THREE.Vector3,c=new THREE.Quaternion,d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3;return function(){g.set(t.x-s.x,t.y-s.y,0),a=g.length(),a?(r.copy(m.object.position).sub(m.target),d.copy(r).normalize(),e.copy(m.object.up).normalize(),f.crossVectors(e,d).normalize(),e.setLength(t.y-s.y),f.setLength(t.x-s.x),g.copy(e.add(f)),b.crossVectors(g,r).normalize(),a*=m.rotateSpeed,c.setFromAxisAngle(b,a),r.applyQuaternion(c),m.object.up.applyQuaternion(c),u.copy(b),v=a):!m.staticMoving&&v&&(v*=Math.sqrt(1-m.dynamicDampingFactor),r.copy(m.object.position).sub(m.target),c.setFromAxisAngle(u,v),r.applyQuaternion(c),m.object.up.applyQuaternion(c)),s.copy(t)}}(),this.zoomCamera=function(){var a;p===n.TOUCH_ZOOM_PAN?(a=z/A,z=A,r.multiplyScalar(a)):(a=1+(x.y-w.y)*m.zoomSpeed,1!==a&&0<a&&r.multiplyScalar(a),m.staticMoving?w.copy(x):w.y+=(x.y-w.y)*this.dynamicDampingFactor)},this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.copy(C).sub(B),a.lengthSq()&&(a.multiplyScalar(r.length()*m.panSpeed),c.copy(r).cross(m.object.up).setLength(a.x),c.add(b.copy(m.object.up).setLength(a.y)),m.object.position.add(c),m.target.add(c),m.staticMoving?B.copy(C):B.add(a.subVectors(C,B).multiplyScalar(m.dynamicDampingFactor)))}}(),this.checkDistances=function(){m.noZoom&&m.noPan||(r.lengthSq()>m.maxDistance*m.maxDistance&&(m.object.position.addVectors(m.target,r.setLength(m.maxDistance)),w.copy(x)),r.lengthSq()<m.minDistance*m.minDistance&&(m.object.position.addVectors(m.target,r.setLength(m.minDistance)),w.copy(x)))},this.update=function(){r.subVectors(m.object.position,m.target),m.noRotate||m.rotateCamera(),m.noZoom||m.zoomCamera(),m.noPan||m.panCamera(),m.object.position.addVectors(m.target,r),m.checkDistances(),m.object.lookAt(m.target),o.distanceToSquared(m.object.position)>1e-6&&(m.dispatchEvent(D),o.copy(m.object.position))},this.reset=function(){p=n.NONE,q=n.NONE,m.target.copy(m.target0),m.object.position.copy(m.position0),m.object.up.copy(m.up0),r.subVectors(m.object.position,m.target),m.object.lookAt(m.target),m.dispatchEvent(D),o.copy(m.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",l,!1),this.domElement.removeEventListener("mousedown",e,!1),this.domElement.removeEventListener("wheel",h,!1),this.domElement.removeEventListener("touchstart",i,!1),this.domElement.removeEventListener("touchend",k,!1),this.domElement.removeEventListener("touchmove",j,!1),document.removeEventListener("mousemove",f,!1),document.removeEventListener("mouseup",g,!1),window.removeEventListener("keydown",c,!1),window.removeEventListener("keyup",d,!1)},this.domElement.addEventListener("contextmenu",l,!1),this.domElement.addEventListener("mousedown",e,!1),this.domElement.addEventListener("wheel",h,!1),this.domElement.addEventListener("touchstart",i,!1),this.domElement.addEventListener("touchend",k,!1),this.domElement.addEventListener("touchmove",j,!1),window.addEventListener("keydown",c,!1),window.addEventListener("keyup",d,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;