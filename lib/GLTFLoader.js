"use strict";THREE.GLTFLoader=function(){function e(e){this.manager=void 0===e?THREE.DefaultLoadingManager:e,this.dracoLoader=null}function a(){var e={};return{get:function get(a){return e[a]},add:function add(a,t){e[a]=t},remove:function remove(a){delete e[a]},removeAll:function removeAll(){e={}}}}function t(){if(!THREE.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=M.MSFT_TEXTURE_DDS,this.ddsLoader=new THREE.DDSLoader}function s(e){this.name=M.KHR_LIGHTS,this.lights={};var a=e.extensions&&e.extensions[M.KHR_LIGHTS]||{},t=a.lights||{};for(var s in t){var r,n=t[s],i=new THREE.Color().fromArray(n.color);switch(n.type){case"directional":r=new THREE.DirectionalLight(i),r.target.position.set(0,0,1),r.add(r.target);break;case"point":r=new THREE.PointLight(i);break;case"spot":r=new THREE.SpotLight(i),n.spot=n.spot||{},n.spot.innerConeAngle=void 0===n.spot.innerConeAngle?0:n.spot.innerConeAngle,n.spot.outerConeAngle=void 0===n.spot.outerConeAngle?Math.PI/4:n.spot.outerConeAngle,r.angle=n.spot.outerConeAngle,r.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,r.target.position.set(0,0,1),r.add(r.target);break;case"ambient":r=new THREE.AmbientLight(i);}r&&(r.decay=2,void 0!==n.intensity&&(r.intensity=n.intensity),r.name=n.name||"light_"+s,this.lights[s]=r)}}function r(){this.name=M.KHR_MATERIALS_UNLIT}function n(e){this.name=M.KHR_BINARY_GLTF,this.content=null,this.body=null;var a=new DataView(e,0,12);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:a.getUint32(4,!0),length:a.getUint32(8,!0)},"glTF"!==this.header.magic)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");else if(2>this.header.version)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var t,s=new DataView(e,12),r=0;r<s.byteLength;){t=s.getUint32(r,!0),r+=4;var n=s.getUint32(r,!0);if(r+=4,n===T.JSON){var i=new Uint8Array(e,12+r,t);this.content=THREE.LoaderUtils.decodeText(i)}else if(n===T.BIN){var o=12+r;this.body=e.slice(o,o+t)}r+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function i(e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=M.KHR_DRACO_MESH_COMPRESSION,this.dracoLoader=e}function o(){return{name:M.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function getMaterialType(){return THREE.ShaderMaterial},extendParams:function extendParams(e,a,t){var s=a.extensions[this.name],r=THREE.ShaderLib.standard,n=THREE.UniformsUtils.clone(r.uniforms),i=r.fragmentShader.replace("#include <specularmap_fragment>","").replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>","#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif").replace("#include <metalnessmap_pars_fragment>","#ifdef USE_GLOSSINESSMAP\n\tuniform sampler2D glossinessMap;\n#endif").replace("#include <roughnessmap_fragment>","vec3 specularFactor = specular;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\ttexelSpecular = sRGBToLinear( texelSpecular );\n\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture\n\tspecularFactor *= texelSpecular.rgb;\n#endif").replace("#include <metalnessmap_fragment>","float glossinessFactor = glossiness;\n#ifdef USE_GLOSSINESSMAP\n\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );\n\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture\n\tglossinessFactor *= texelGlossiness.a;\n#endif").replace("#include <lights_physical_fragment>","PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );\nmaterial.specularColor = specularFactor.rgb;");delete n.roughness,delete n.metalness,delete n.roughnessMap,delete n.metalnessMap,n.specular={value:new THREE.Color().setHex(1118481)},n.glossiness={value:.5},n.specularMap={value:null},n.glossinessMap={value:null},e.vertexShader=r.vertexShader,e.fragmentShader=i,e.uniforms=n,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var o=[];if(Array.isArray(s.diffuseFactor)){var l=s.diffuseFactor;e.color.fromArray(l),e.opacity=l[3]}if(void 0!==s.diffuseTexture&&o.push(t.assignTexture(e,"map",s.diffuseTexture.index)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0===s.glossinessFactor?1:s.glossinessFactor,e.specular=new THREE.Color(1,1,1),Array.isArray(s.specularFactor)&&e.specular.fromArray(s.specularFactor),void 0!==s.specularGlossinessTexture){var p=s.specularGlossinessTexture.index;o.push(t.assignTexture(e,"glossinessMap",p)),o.push(t.assignTexture(e,"specularMap",p))}return Promise.all(o)},createMaterial:function createMaterial(e){var a=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return a.isGLTFSpecularGlossinessMaterial=!0,a.color=e.color,a.map=void 0===e.map?null:e.map,a.lightMap=null,a.lightMapIntensity=1,a.aoMap=void 0===e.aoMap?null:e.aoMap,a.aoMapIntensity=1,a.emissive=e.emissive,a.emissiveIntensity=1,a.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,a.bumpMap=void 0===e.bumpMap?null:e.bumpMap,a.bumpScale=1,a.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(a.normalScale=e.normalScale),a.displacementMap=null,a.displacementScale=1,a.displacementBias=0,a.specularMap=void 0===e.specularMap?null:e.specularMap,a.specular=e.specular,a.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,a.glossiness=e.glossiness,a.alphaMap=null,a.envMap=void 0===e.envMap?null:e.envMap,a.envMapIntensity=1,a.refractionRatio=.98,a.extensions.derivatives=!0,a},cloneMaterial:function cloneMaterial(e){var a=e.clone();a.isGLTFSpecularGlossinessMaterial=!0;for(var t=this.specularGlossinessParams,s=0,r=t.length;s<r;s++)a[t[s]]=e[t[s]];return a},refreshUniforms:function refreshUniforms(e,a,t,s,r){if(!0===r.isGLTFSpecularGlossinessMaterial){var n=r.uniforms,i=r.defines;n.opacity.value=r.opacity,n.diffuse.value.copy(r.color),n.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),n.map.value=r.map,n.specularMap.value=r.specularMap,n.alphaMap.value=r.alphaMap,n.lightMap.value=r.lightMap,n.lightMapIntensity.value=r.lightMapIntensity,n.aoMap.value=r.aoMap,n.aoMapIntensity.value=r.aoMapIntensity;var o;if(r.map?o=r.map:r.specularMap?o=r.specularMap:r.displacementMap?o=r.displacementMap:r.normalMap?o=r.normalMap:r.bumpMap?o=r.bumpMap:r.glossinessMap?o=r.glossinessMap:r.alphaMap?o=r.alphaMap:r.emissiveMap&&(o=r.emissiveMap),void 0!==o){o.isWebGLRenderTarget&&(o=o.texture);var l,p;if(void 0!==o.matrix){if(!0===o.matrixAutoUpdate){l=o.offset,p=o.repeat;var d=o.rotation,c=o.center;o.matrix.setUvTransform(l.x,l.y,p.x,p.y,d,c.x,c.y)}n.uvTransform.value.copy(o.matrix)}else l=o.offset,p=o.repeat,n.offsetRepeat.value.set(l.x,l.y,p.x,p.y)}n.envMap.value=r.envMap,n.envMapIntensity.value=r.envMapIntensity,n.flipEnvMap.value=r.envMap&&r.envMap.isCubeTexture?-1:1,n.refractionRatio.value=r.refractionRatio,n.specular.value.copy(r.specular),n.glossiness.value=r.glossiness,n.glossinessMap.value=r.glossinessMap,n.emissiveMap.value=r.emissiveMap,n.bumpMap.value=r.bumpMap,n.normalMap.value=r.normalMap,n.displacementMap.value=r.displacementMap,n.displacementScale.value=r.displacementScale,n.displacementBias.value=r.displacementBias,null!==n.glossinessMap.value&&void 0===i.USE_GLOSSINESSMAP&&(i.USE_GLOSSINESSMAP="",i.USE_ROUGHNESSMAP=""),null===n.glossinessMap.value&&void 0!==i.USE_GLOSSINESSMAP&&(delete i.USE_GLOSSINESSMAP,delete i.USE_ROUGHNESSMAP)}}}}function l(e,a,t,s){THREE.Interpolant.call(this,e,a,t,s)}function p(e,a){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:a+e}function d(){return new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})}function c(e,a,t,s){for(var r,n=e.geometry,o=t.targets,l=!1,p=!1,d=0,c=o.length;d<c&&(r=o[d],void 0!==r.POSITION&&(l=!0),void 0!==r.NORMAL&&(p=!0),!(l&&p));d++);if(l||p){for(var u=[],m=[],d=0,c=o.length;d<c;d++){var r=o[d],h="morphTarget"+d;if(l){if(void 0!==r.POSITION){var S=g(s[r.POSITION]);S.name=h;for(var M=n.attributes.position,f=0,T=S.count;f<T;f++)S.setXYZ(f,S.getX(f)+M.getX(f),S.getY(f)+M.getY(f),S.getZ(f)+M.getZ(f))}else S=n.attributes.position;u.push(S)}if(p){var L;if(void 0!==r.NORMAL){var L=g(s[r.NORMAL]);L.name=h;for(var R=n.attributes.normal,f=0,T=L.count;f<T;f++)L.setXYZ(f,L.getX(f)+R.getX(f),L.getY(f)+R.getY(f),L.getZ(f)+R.getZ(f))}else L=n.attributes.normal;m.push(L)}}if(l&&(n.morphAttributes.position=u),p&&(n.morphAttributes.normal=m),e.updateMorphTargets(),void 0!==a.weights)for(var d=0,c=a.weights.length;d<c;d++)e.morphTargetInfluences[d]=a.weights[d];if(a.extras&&Array.isArray(a.extras.targetNames)){var y=a.extras.targetNames;if(e.morphTargetInfluences.length===y.length){e.morphTargetDictionary={};for(var d=0,c=y.length;d<c;d++)e.morphTargetDictionary[y[d]]=d}else;}}}function u(e,a){if(e.indices!==a.indices)return!1;var t=e.attributes||{},s=a.attributes||{},r=Object.keys(t),n=Object.keys(s);if(r.length!==n.length)return!1;for(var o,l=0,p=r.length;l<p;l++)if(o=r[l],t[o]!==s[o])return!1;return!0}function m(e,a){for(var t,s=0,r=e.length;s<r;s++)if(t=e[s],u(t.primitive,a))return t.promise;return null}function g(e){if(e.isInterleavedBufferAttribute){for(var a=e.count,t=e.itemSize,s=e.array.slice(0,a*t),r=0;r<a;++r)s[r]=e.getX(r),2<=t&&(s[r+1]=e.getY(r)),3<=t&&(s[r+2]=e.getZ(r)),4<=t&&(s[r+3]=e.getW(r));return new THREE.BufferAttribute(s,t,e.normalized)}return e.clone()}function h(e,t,s){this.json=e||{},this.extensions=t||{},this.options=s||{},this.cache=new a,this.primitiveCache=[],this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function S(e,a,t){var s=a.attributes;for(var r in s){var n=N[r],i=t[s[r]];n&&!(n in e.attributes)&&e.addAttribute(n,i)}void 0===a.indices||e.index||e.setIndex(t[a.indices])}e.prototype={constructor:e,crossOrigin:"Anonymous",load:function load(e,a,t,s){var r=this,n=void 0===this.path?THREE.LoaderUtils.extractUrlBase(e):this.path,i=new THREE.FileLoader(r.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){try{r.parse(e,n,a,s)}catch(a){if(void 0!==s)s(a);else throw a}},t,s)},setCrossOrigin:function setCrossOrigin(e){return this.crossOrigin=e,this},setPath:function setPath(e){return this.path=e,this},setDRACOLoader:function setDRACOLoader(e){return this.dracoLoader=e,this},parse:function parse(e,a,l,p){var d,c={};if("string"==typeof e)d=e;else{var u=THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4));if(u===f){try{c[M.KHR_BINARY_GLTF]=new n(e)}catch(e){return void(p&&p(e))}d=c[M.KHR_BINARY_GLTF].content}else d=THREE.LoaderUtils.decodeText(new Uint8Array(e))}var m=JSON.parse(d);if(void 0===m.asset||2>m.asset.version[0])return void(p&&p(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead.")));m.extensionsUsed&&(0<=m.extensionsUsed.indexOf(M.KHR_LIGHTS)&&(c[M.KHR_LIGHTS]=new s(m)),0<=m.extensionsUsed.indexOf(M.KHR_MATERIALS_UNLIT)&&(c[M.KHR_MATERIALS_UNLIT]=new r(m)),0<=m.extensionsUsed.indexOf(M.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS)&&(c[M.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]=new o),0<=m.extensionsUsed.indexOf(M.KHR_DRACO_MESH_COMPRESSION)&&(c[M.KHR_DRACO_MESH_COMPRESSION]=new i(this.dracoLoader)),0<=m.extensionsUsed.indexOf(M.MSFT_TEXTURE_DDS)&&(c[M.MSFT_TEXTURE_DDS]=new t));var g=new h(m,c,{path:a||this.path||"",crossOrigin:this.crossOrigin,manager:this.manager});g.parse(function(e,a,t,s,r){l({scene:e,scenes:a,cameras:t,animations:s,asset:r})},p)}};var M={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS:"KHR_lights",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};r.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial},r.prototype.extendParams=function(e,a,t){var s=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var r=a.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){var n=r.baseColorFactor;e.color.fromArray(n),e.opacity=n[3]}void 0!==r.baseColorTexture&&s.push(t.assignTexture(e,"map",r.baseColorTexture.index))}return Promise.all(s)};var f="glTF",T={JSON:1313821514,BIN:5130562};i.prototype.decodePrimitive=function(e,a){var t=this.dracoLoader,s=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,n={};for(var i in r)i in N&&(n[N[i]]=r[i]);return a.getDependency("bufferView",s).then(function(e){return new Promise(function(a){t.decodeDracoFile(e,a,n)})})},l.prototype=Object.create(THREE.Interpolant.prototype),l.prototype.constructor=l,l.prototype.interpolate_=function(e,a,s,t){for(var r=this.resultBuffer,n=this.sampleValues,o=this.valueSize,l=3*o,d=t-a,c=(s-a)/d,p=c*c,u=p*c,m=e*l,g=m-l,h=0;h!==o;h++){var S=n[g+h+o],M=n[g+h+2*o]*d,f=n[m+h+o],T=n[m+h]*d;r[h]=(2*u-3*p+1)*S+(u-2*p+c)*M+(-2*u+3*p)*f+(u-p)*T}return r};var L={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},R={5126:Number,35675:THREE.Matrix3,35676:THREE.Matrix4,35664:THREE.Vector2,35665:THREE.Vector3,35666:THREE.Vector4,35678:THREE.Texture},y={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},A={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},x={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},_={6406:THREE.AlphaFormat,6407:THREE.RGBFormat,6408:THREE.RGBAFormat,6409:THREE.LuminanceFormat,6410:THREE.LuminanceAlphaFormat},E={5121:THREE.UnsignedByteType,32819:THREE.UnsignedShort4444Type,32820:THREE.UnsignedShort5551Type,33635:THREE.UnsignedShort565Type},I={1028:THREE.BackSide,1029:THREE.FrontSide},v={512:THREE.NeverDepth,513:THREE.LessDepth,514:THREE.EqualDepth,515:THREE.LessEqualDepth,516:THREE.GreaterEqualDepth,517:THREE.NotEqualDepth,518:THREE.GreaterEqualDepth,519:THREE.AlwaysDepth},b={32774:THREE.AddEquation,32778:THREE.SubtractEquation,32779:THREE.ReverseSubtractEquation},F={0:THREE.ZeroFactor,1:THREE.OneFactor,768:THREE.SrcColorFactor,769:THREE.OneMinusSrcColorFactor,770:THREE.SrcAlphaFactor,771:THREE.OneMinusSrcAlphaFactor,772:THREE.DstAlphaFactor,773:THREE.OneMinusDstAlphaFactor,774:THREE.DstColorFactor,775:THREE.OneMinusDstColorFactor,776:THREE.SrcAlphaSaturateFactor},O={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},N={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD0:"uv",TEXCOORD:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",COLOR0:"color",COLOR:"color",WEIGHTS_0:"skinWeight",WEIGHT:"skinWeight",JOINTS_0:"skinIndex",JOINT:"skinIndex"},G={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},D={CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},C={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};return h.prototype.parse=function(e,a){var t=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(a){var s=a.scenes||[],r=s[t.scene||0],n=a.animations||[],i=t.asset,o=a.cameras||[];e(r,s,o,n,i)})["catch"](a)},h.prototype.markDefs=function(){for(var e,a=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[],r={},n={},o=0,l=t.length;o<l;o++){e=t[o].joints;for(var p=0,d=e.length;p<d;p++)a[e[p]].isBone=!0}for(var c,u=0,m=a.length;u<m;u++)c=a[u],void 0!==c.mesh&&(void 0===r[c.mesh]&&(r[c.mesh]=n[c.mesh]=0),r[c.mesh]++,void 0!==c.skin&&(s[c.mesh].isSkinnedMesh=!0));this.json.meshReferences=r,this.json.meshUses=n},h.prototype.getDependency=function(e,a){var t=e+":"+a,s=this.cache.get(t);if(!s){switch(e){case"scene":s=this.loadScene(a);break;case"node":s=this.loadNode(a);break;case"mesh":s=this.loadMesh(a);break;case"accessor":s=this.loadAccessor(a);break;case"bufferView":s=this.loadBufferView(a);break;case"buffer":s=this.loadBuffer(a);break;case"material":s=this.loadMaterial(a);break;case"texture":s=this.loadTexture(a);break;case"skin":s=this.loadSkin(a);break;case"animation":s=this.loadAnimation(a);break;case"camera":s=this.loadCamera(a);break;default:throw new Error("Unknown type: "+e);}this.cache.add(t,s)}return s},h.prototype.getDependencies=function(e){var a=this.cache.get(e);if(!a){var t=this,s=this.json[e+("mesh"===e?"es":"s")]||[];a=Promise.all(s.map(function(a,s){return t.getDependency(e,s)})),this.cache.add(e,a)}return a},h.prototype.getMultiDependencies=function(e){for(var a={},t=[],s=0,r=e.length;s<r;s++){var n=e[s],o=this.getDependencies(n);o=o.then(function(e,t){a[e]=t}.bind(this,n+("mesh"===n?"es":"s"))),t.push(o)}return Promise.all(t).then(function(){return a})},h.prototype.loadBuffer=function(e){var a=this.json.buffers[e],t=this.fileLoader;if(a.type&&"arraybuffer"!==a.type)throw new Error("THREE.GLTFLoader: "+a.type+" buffer type is not supported.");if(void 0===a.uri&&0===e)return Promise.resolve(this.extensions[M.KHR_BINARY_GLTF].body);var s=this.options;return new Promise(function(e,r){t.load(p(a.uri,s.path),e,void 0,function(){r(new Error("THREE.GLTFLoader: Failed to load buffer \""+a.uri+"\"."))})})},h.prototype.loadBufferView=function(e){var a=this.json.bufferViews[e];return this.getDependency("buffer",a.buffer).then(function(e){var t=a.byteLength||0,s=a.byteOffset||0;return e.slice(s,s+t)})},h.prototype.loadAccessor=function(e){var a=this,t=this.json,s=this.json.accessors[e];if(void 0===s.bufferView&&void 0===s.sparse)return null;var r=[];return void 0===s.bufferView?r.push(null):r.push(this.getDependency("bufferView",s.bufferView)),void 0!==s.sparse&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(e){var r,n,o=e[0],l=O[s.type],p=y[s.componentType],d=p.BYTES_PER_ELEMENT,c=s.byteOffset||0,u=t.bufferViews[s.bufferView].byteStride,m=!0===s.normalized;if(u&&u!==d*l){var g="InterleavedBuffer:"+s.bufferView+":"+s.componentType,h=a.cache.get(g);h||(r=new p(o),h=new THREE.InterleavedBuffer(r,u/d),a.cache.add(g,h)),n=new THREE.InterleavedBufferAttribute(h,l,c/d,m)}else r=null===o?new p(s.count*l):new p(o,c,s.count*l),n=new THREE.BufferAttribute(r,l,m);if(void 0!==s.sparse){var S=O.SCALAR,M=y[s.sparse.indices.componentType],f=s.sparse.indices.byteOffset||0,T=s.sparse.values.byteOffset||0,L=new M(e[1],f,s.sparse.count*S),R=new p(e[2],T,s.sparse.count*l);null!==o&&n.setArray(n.array.slice());for(var A,x=0,_=L.length;x<_;x++)if(A=L[x],n.setX(A,R[x*l]),2<=l&&n.setY(A,R[x*l+1]),3<=l&&n.setZ(A,R[x*l+2]),4<=l&&n.setW(A,R[x*l+3]),5<=l)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}return n})},h.prototype.loadTexture=function(e){var a,t=this,s=this.json,r=this.options,n=this.textureLoader,i=window.URL||window.webkitURL,o=s.textures[e],l=o.extensions||{};a=l[M.MSFT_TEXTURE_DDS]?s.images[l[M.MSFT_TEXTURE_DDS].source]:s.images[o.source];var d=a.uri,c=!1;return void 0!==a.bufferView&&(d=t.getDependency("bufferView",a.bufferView).then(function(e){c=!0;var t=new Blob([e],{type:a.mimeType});return d=i.createObjectURL(t),d})),Promise.resolve(d).then(function(e){var a=THREE.Loader.Handlers.get(e);return a||(a=l[M.MSFT_TEXTURE_DDS]?t.extensions[M.MSFT_TEXTURE_DDS].ddsLoader:n),new Promise(function(t,s){a.load(p(e,r.path),t,void 0,s)})}).then(function(e){!0===c&&i.revokeObjectURL(d),e.flipY=!1,void 0!==o.name&&(e.name=o.name),l[M.MSFT_TEXTURE_DDS]||(e.format=void 0===o.format?THREE.RGBAFormat:_[o.format]),void 0!==o.internalFormat&&e.format!==_[o.internalFormat]&&void 0,e.type=void 0===o.type?THREE.UnsignedByteType:E[o.type];var a=s.samplers||{},t=a[o.sampler]||{};return e.magFilter=A[t.magFilter]||THREE.LinearFilter,e.minFilter=A[t.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=x[t.wrapS]||THREE.RepeatWrapping,e.wrapT=x[t.wrapT]||THREE.RepeatWrapping,e})},h.prototype.assignTexture=function(e,a,t){return this.getDependency("texture",t).then(function(t){e[a]=t})},h.prototype.loadMaterial=function(e){var a,t=this,s=this.json,r=this.extensions,n=this.json.materials[e],i={},o=n.extensions||{},l=[];if(o[M.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var p=r[M.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a=p.getMaterialType(n),l.push(p.extendParams(i,n,t))}else if(o[M.KHR_MATERIALS_UNLIT]){var d=r[M.KHR_MATERIALS_UNLIT];a=d.getMaterialType(n),l.push(d.extendParams(i,n,t))}else{a=THREE.MeshStandardMaterial;var c=n.pbrMetallicRoughness||{};if(i.color=new THREE.Color(1,1,1),i.opacity=1,Array.isArray(c.baseColorFactor)){var u=c.baseColorFactor;i.color.fromArray(u),i.opacity=u[3]}if(void 0!==c.baseColorTexture&&l.push(t.assignTexture(i,"map",c.baseColorTexture.index)),i.metalness=void 0===c.metallicFactor?1:c.metallicFactor,i.roughness=void 0===c.roughnessFactor?1:c.roughnessFactor,void 0!==c.metallicRoughnessTexture){var m=c.metallicRoughnessTexture.index;l.push(t.assignTexture(i,"metalnessMap",m)),l.push(t.assignTexture(i,"roughnessMap",m))}}!0===n.doubleSided&&(i.side=THREE.DoubleSide);var g=n.alphaMode||C.OPAQUE;return g===C.BLEND?i.transparent=!0:(i.transparent=!1,g===C.MASK&&(i.alphaTest=void 0===n.alphaCutoff?.5:n.alphaCutoff)),void 0!==n.normalTexture&&a!==THREE.MeshBasicMaterial&&(l.push(t.assignTexture(i,"normalMap",n.normalTexture.index)),i.normalScale=new THREE.Vector2(1,1),void 0!==n.normalTexture.scale&&i.normalScale.set(n.normalTexture.scale,n.normalTexture.scale)),void 0!==n.occlusionTexture&&a!==THREE.MeshBasicMaterial&&(l.push(t.assignTexture(i,"aoMap",n.occlusionTexture.index)),void 0!==n.occlusionTexture.strength&&(i.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&a!==THREE.MeshBasicMaterial&&(i.emissive=new THREE.Color().fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&a!==THREE.MeshBasicMaterial&&l.push(t.assignTexture(i,"emissiveMap",n.emissiveTexture.index)),Promise.all(l).then(function(){var e;return e=a===THREE.ShaderMaterial?r[M.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(i):new a(i),void 0!==n.name&&(e.name=n.name),e.normalScale&&(e.normalScale.y=-e.normalScale.y),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),n.extras&&(e.userData=n.extras),e})},h.prototype.loadGeometries=function(e){var a=this,t=this.extensions,s=this.primitiveCache;return this.getDependencies("accessor").then(function(r){for(var n=[],o=0,l=e.length;o<l;o++){var p=e[o],d=m(s,p);if(d)n.push(d);else if(p.extensions&&p.extensions[M.KHR_DRACO_MESH_COMPRESSION]){var c=t[M.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(p,a).then(function(e){return S(e,p,r),e});s.push({primitive:p,promise:c}),n.push(c)}else{var u=new THREE.BufferGeometry;S(u,p,r);var c=Promise.resolve(u);s.push({primitive:p,promise:c}),n.push(c)}}return Promise.all(n)})},h.prototype.loadMesh=function(e){var a=this,t=this.json,s=this.extensions,r=this.json.meshes[e];return this.getMultiDependencies(["accessor","material"]).then(function(t){var n=new THREE.Group,o=r.primitives;return a.loadGeometries(o).then(function(l){for(var p=0,u=o.length;p<u;p++){var m=o[p],g=l[p],h=void 0===m.material?d():t.materials[m.material];h.aoMap&&void 0===g.attributes.uv2&&void 0!==g.attributes.uv&&(g.addAttribute("uv2",new THREE.BufferAttribute(g.attributes.uv.array,2)));var S=void 0!==g.attributes.color,f=void 0===g.attributes.normal,T=!0===r.isSkinnedMesh,R=void 0!==m.targets;if(S||f||T||R)if(h.isGLTFSpecularGlossinessMaterial){var y=s[M.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];h=y.cloneMaterial(h)}else h=h.clone();S&&(h.vertexColors=THREE.VertexColors,h.needsUpdate=!0),f&&(h.flatShading=!0);var A;if(m.mode===L.TRIANGLES||m.mode===L.TRIANGLE_STRIP||m.mode===L.TRIANGLE_FAN||void 0===m.mode)T?(A=new THREE.SkinnedMesh(g,h),h.skinning=!0):A=new THREE.Mesh(g,h),m.mode===L.TRIANGLE_STRIP?A.drawMode=THREE.TriangleStripDrawMode:m.mode===L.TRIANGLE_FAN&&(A.drawMode=THREE.TriangleFanDrawMode);else if(m.mode===L.LINES||m.mode===L.LINE_STRIP||m.mode===L.LINE_LOOP){var x="LineBasicMaterial:"+h.uuid,_=a.cache.get(x);_||(_=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(_,h),_.color.copy(h.color),_.lights=!1,a.cache.add(x,_)),h=_,A=m.mode===L.LINES?new THREE.LineSegments(g,h):m.mode===L.LINE_STRIP?new THREE.Line(g,h):new THREE.LineLoop(g,h)}else if(m.mode===L.POINTS){var x="PointsMaterial:"+h.uuid,E=a.cache.get(x);E||(E=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(E,h),E.color.copy(h.color),E.map=h.map,E.lights=!1,a.cache.add(x,E)),h=E,A=new THREE.Points(g,h)}else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);if(A.name=r.name||"mesh_"+e,R&&(c(A,r,m,t.accessors),h.morphTargets=!0,void 0!==A.geometry.morphAttributes.normal&&(h.morphNormals=!0)),void 0!==r.extras&&(A.userData=r.extras),void 0!==m.extras&&(A.geometry.userData=m.extras),!0===h.isGLTFSpecularGlossinessMaterial&&(A.onBeforeRender=s[M.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),1<o.length)A.name+="_"+p,n.add(A);else return A}return n})})},h.prototype.loadCamera=function(e){var a,t=this.json.cameras[e],s=t[t.type];if(s)return"perspective"===t.type?a=new THREE.PerspectiveCamera(THREE.Math.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):"orthographic"===t.type&&(a=new THREE.OrthographicCamera(s.xmag/-2,s.xmag/2,s.ymag/2,s.ymag/-2,s.znear,s.zfar)),void 0!==t.name&&(a.name=t.name),t.extras&&(a.userData=t.extras),Promise.resolve(a)},h.prototype.loadSkin=function(e){var a=this.json.skins[e],t={joints:a.joints};return void 0===a.inverseBindMatrices?Promise.resolve(t):this.getDependency("accessor",a.inverseBindMatrices).then(function(e){return t.inverseBindMatrices=e,t})},h.prototype.loadAnimation=function(e){var a=this.json,t=this.json.animations[e];return this.getMultiDependencies(["accessor","node"]).then(function(a){for(var s=[],r=0,n=t.channels.length;r<n;r++){var o=t.channels[r],p=t.samplers[o.sampler];if(p){var d=o.target,c=void 0===d.node?d.id:d.node,u=void 0===t.parameters?p.input:t.parameters[p.input],m=void 0===t.parameters?p.output:t.parameters[p.output],g=a.accessors[u],h=a.accessors[m],S=a.nodes[c];if(S){S.updateMatrix(),S.matrixAutoUpdate=!0;var M;switch(G[d.path]){case G.weights:M=THREE.NumberKeyframeTrack;break;case G.rotation:M=THREE.QuaternionKeyframeTrack;break;case G.position:case G.scale:default:M=THREE.VectorKeyframeTrack;}var f=S.name?S.name:S.uuid,T=void 0===p.interpolation?THREE.InterpolateLinear:D[p.interpolation],L=[];G[d.path]===G.weights?S.traverse(function(e){!0===e.isMesh&&!0===e.material.morphTargets&&L.push(e.name?e.name:e.uuid)}):L.push(f);for(var R,y=0,A=L.length;y<A;y++)R=new M(L[y]+"."+G[d.path],THREE.AnimationUtils.arraySlice(g.array,0),THREE.AnimationUtils.arraySlice(h.array,0),T),"CUBICSPLINE"===p.interpolation&&(R.createInterpolant=function(e){return new l(this.times,this.values,this.getValueSize()/3,e)},R.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),s.push(R)}}}var c=void 0===t.name?"animation_"+e:t.name;return new THREE.AnimationClip(c,void 0,s)})},h.prototype.loadNode=function(e){var a=this.json,t=this.extensions,s=this.json.meshReferences,r=this.json.meshUses,n=this.json.nodes[e];return this.getMultiDependencies(["mesh","skin","camera","light"]).then(function(e){var a;if(!0===n.isBone)a=new THREE.Bone;else if(void 0!==n.mesh){var o=e.meshes[n.mesh];if(a=o.clone(),!0===o.isGroup)for(var l,p=0,d=o.children.length;p<d;p++)l=o.children[p],l.material&&!0===l.material.isGLTFSpecularGlossinessMaterial&&(a.children[p].onBeforeRender=l.onBeforeRender);else o.material&&!0===o.material.isGLTFSpecularGlossinessMaterial&&(a.onBeforeRender=o.onBeforeRender);1<s[n.mesh]&&(a.name+="_instance_"+r[n.mesh]++)}else if(void 0!==n.camera)a=e.cameras[n.camera];else if(n.extensions&&n.extensions[M.KHR_LIGHTS]&&void 0!==n.extensions[M.KHR_LIGHTS].light){var c=t[M.KHR_LIGHTS].lights;a=c[n.extensions[M.KHR_LIGHTS].light]}else a=new THREE.Object3D;if(void 0!==n.name&&(a.name=THREE.PropertyBinding.sanitizeNodeName(n.name)),n.extras&&(a.userData=n.extras),void 0!==n.matrix){var u=new THREE.Matrix4;u.fromArray(n.matrix),a.applyMatrix(u)}else void 0!==n.translation&&a.position.fromArray(n.translation),void 0!==n.rotation&&a.quaternion.fromArray(n.rotation),void 0!==n.scale&&a.scale.fromArray(n.scale);return a})},h.prototype.loadScene=function(){function e(a,t,s,r,n){var o=r[a],l=s.nodes[a];if(void 0!==l.skin)for(var p=!0===o.isGroup?o.children:[o],d=0,c=p.length;d<c;d++){for(var u=p[d],m=n[l.skin],g=[],h=[],S=0,M=m.joints.length;S<M;S++){var f=m.joints[S],T=r[f];if(T){g.push(T);var L=new THREE.Matrix4;void 0!==m.inverseBindMatrices&&L.fromArray(m.inverseBindMatrices.array,16*S),h.push(L)}else;}u.bind(new THREE.Skeleton(g,h),u.matrixWorld)}if(t.add(o),l.children)for(var R,y=l.children,d=0,c=y.length;d<c;d++)R=y[d],e(R,o,s,r,n)}return function(a){var t=this.json,s=this.extensions,r=this.json.scenes[a];return this.getMultiDependencies(["node","skin"]).then(function(a){var n=new THREE.Scene;void 0!==r.name&&(n.name=r.name),r.extras&&(n.userData=r.extras);for(var o=r.nodes||[],l=0,p=o.length;l<p;l++)e(o[l],n,t,a.nodes,a.skins);if(r.extensions&&r.extensions[M.KHR_LIGHTS]&&void 0!==r.extensions[M.KHR_LIGHTS].light){var d=s[M.KHR_LIGHTS].lights;n.add(d[r.extensions[M.KHR_LIGHTS].light])}return n})}}(),e}();